<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeggiPlan: Vegetarian Meal Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .glass-card-dark {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Line clamp utilities */
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        /* Modern gradient buttons */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(168, 237, 234, 0.4);
        }
        /* Selected recipe styling */
        .recipe-selected {
            border: 2px solid #667eea;
            background: rgba(102, 126, 234, 0.15);
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        /* Modern meal slot styling */
        .meal-slot {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .meal-slot:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        /* Hide the scrollbar but keep it scrollable */
        /* Modern scrollbar styling */
        #recipe-list::-webkit-scrollbar,
        #shopping-list-content::-webkit-scrollbar {
            width: 6px;
        }
        #recipe-list::-webkit-scrollbar-track,
        #shopping-list-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb,
        #shopping-list-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb:hover,
        #shopping-list-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Recipe card modern styling */
        .recipe-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .recipe-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-4 py-8 sm:px-6 lg:px-8 max-w-7xl">
        <header class="text-center mb-12 sm:mb-16">
            <div class="inline-block p-8 rounded-3xl glass-card mb-8">
                <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold bg-gradient-to-r from-white via-blue-100 to-purple-100 bg-clip-text text-transparent leading-tight mb-4">
                    ü•¨ VeggiPlan
                </h1>
                <p class="text-white/90 mt-4 text-lg sm:text-xl lg:text-2xl px-4 sm:px-0 font-light leading-relaxed max-w-3xl mx-auto">
                    Experience modern meal planning with curated vegetarian recipes from around the world
                </p>
            </div>
            <div id="refresh-indicator" class="mt-6 p-4 glass-card-dark text-white rounded-2xl text-sm font-medium inline-block" style="display: none;">
                ‚ú® Fetching fresh recipes...
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
            <!-- Weekly Planner Section -->
            <div class="lg:col-span-2 glass-card p-6 sm:p-8 rounded-3xl shadow-2xl">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-3">
                    <h2 class="text-2xl sm:text-3xl font-bold text-white mb-2">Your Weekly Plan</h2>
                    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                        <button id="generate-plan-btn" class="btn-primary text-white font-semibold py-3 px-6 rounded-2xl text-sm sm:text-base">‚ú® Generate Plan</button>
                        <button id="clear-plan-btn" class="btn-secondary font-semibold py-3 px-6 rounded-2xl text-sm sm:text-base">üóë Clear Plan</button>
                    </div>
                </div>
                <div id="weekly-planner" class="space-y-3 sm:space-y-4">
                    <!-- Day rows will be generated by JS -->
                </div>
            </div>

            <!-- Sidebar with Recipe Library and Shopping List -->
            <div class="lg:col-span-1 space-y-4 sm:space-y-6 lg:space-y-8">
                
                <!-- Recipe Library Section -->
                <div class="glass-card p-6 sm:p-8 rounded-3xl shadow-2xl">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-white">Recipe Library</h2>
                    <div class="flex flex-wrap gap-2 sm:gap-3 mb-6">
                        <button class="filter-btn btn-primary text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all" data-cuisine="all">All</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Indian">Indian</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Italian">Italian</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Mexican">Mexican</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Gujarati">Gujarati</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Mediterranean">Mediterranean</button>
                        <button class="filter-btn glass-card-dark text-white px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-white/20" data-cuisine="Thai">Thai</button>
                        <button id="refresh-recipes-btn" class="btn-secondary px-4 sm:px-5 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all" title="Get new recipes">
                            üîÑ New Recipes
                        </button>
                    </div>
                    <div id="recipe-list" class="space-y-3 sm:space-y-4 max-h-[40vh] overflow-y-auto pr-1 sm:pr-2">
                        <!-- Recipe cards will be generated by JS -->
                    </div>
                    <button id="add-recipe-btn" class="w-full mt-6 btn-primary text-white font-semibold py-4 px-6 rounded-2xl text-sm sm:text-base">‚ûï Add New Recipe</button>
                </div>

                <!-- Shopping List Section -->
                <div class="glass-card p-6 sm:p-8 rounded-3xl shadow-2xl">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <h2 class="text-2xl sm:text-3xl font-bold text-white">Shopping List</h2>
                        <div class="flex gap-3">
                            <button id="generate-shopping-list-btn" class="btn-primary text-white font-semibold py-2.5 px-5 rounded-2xl text-xs sm:text-sm">üìù Generate</button>
                            <button id="clear-shopping-list-btn" class="btn-secondary font-semibold py-2.5 px-5 rounded-2xl text-xs sm:text-sm">üóë Clear</button>
                        </div>
                    </div>
                    <div id="shopping-list-content" class="max-h-[35vh] overflow-y-auto">
                        <div id="shopping-list-empty" class="text-center text-white/70 py-12">
                            <div class="text-4xl mb-4">üõçÔ∏è</div>
                            <p class="text-lg mb-2 font-medium">No shopping list yet</p>
                            <p class="text-sm opacity-80">Generate from your weekly plan</p>
                        </div>
                        <div id="shopping-list-items" class="hidden space-y-3">
                            <!-- Shopping list items will be generated by JS -->
                        </div>
                    </div>
                    <div id="shopping-list-summary" class="hidden mt-6 pt-6 border-t border-white/20">
                        <p class="text-sm text-white/80">
                            <span class="font-semibold">Total items:</span>
                            <span id="total-items-count" class="font-bold text-white">0</span>
                        </p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Recipe Detail Modal -->
    <div id="recipe-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 sm:p-6 hidden z-50">
        <div id="modal-content" class="modal-enter glass-card rounded-3xl shadow-2xl w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
             <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Add Recipe Modal -->
    <div id="add-recipe-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 sm:p-6 hidden z-50">
        <div class="modal-content transform scale-95 glass-card rounded-3xl shadow-2xl w-full max-w-2xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <div class="p-6 sm:p-8 border-b border-white/20 flex justify-between items-center">
                <h3 class="text-2xl sm:text-3xl font-bold text-white">Add a New Recipe</h3>
                <button id="add-modal-close-btn" class="text-3xl sm:text-4xl font-light text-white/70 hover:text-white p-2 rounded-xl hover:bg-white/10 transition-all">&times;</button>
            </div>
            <form id="add-recipe-form" class="p-6 sm:p-8 space-y-6">
                <input type="text" name="name" placeholder="Recipe Name" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" required>
                <select name="cuisine" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" required>
                    <option value="" disabled selected>Select Cuisine</option>
                    <option value="Indian">Indian</option>
                    <option value="Italian">Italian</option>
                    <option value="Mexican">Mexican</option>
                    <option value="Mediterranean">Mediterranean</option>
                    <option value="Thai">Thai</option>
                    <option value="Korean">Korean</option>
                    <option value="Japanese">Japanese</option>
                    <option value="Middle Eastern">Middle Eastern</option>
                    <option value="Ethiopian">Ethiopian</option>
                    <option value="Moroccan">Moroccan</option>
                    <option value="Brazilian">Brazilian</option>
                    <option value="Spanish">Spanish</option>
                    <option value="Gujarati">Gujarati</option>
                    <option value="Breakfast">Breakfast</option>
                </select>
                <textarea name="description" placeholder="Short description" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" rows="2" required></textarea>
                <div class="grid grid-cols-2 gap-4 sm:gap-6">
                    <input type="number" name="prepTime" placeholder="Prep time (mins)" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" required>
                    <input type="number" name="cookTime" placeholder="Cook time (mins)" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" required>
                </div>
                <textarea name="ingredients" placeholder="Ingredients (one per line)" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" rows="5" required></textarea>
                <textarea name="instructions" placeholder="Instructions (use '1. Step one...' format)" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-sm sm:text-base text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-white/50 backdrop-blur-sm transition-all" rows="6" required></textarea>
                <button type="submit" class="w-full btn-primary text-white font-semibold py-4 px-6 rounded-2xl text-sm sm:text-base">‚ú® Save Recipe</button>
            </form>
        </div>
    </div>

<script src="recipes.js"></script>
<script>
// --- RECIPE DATABASE ---
// Recipes are now loaded from recipes.js file
// The recipes will be available as window.initialRecipes

document.addEventListener('DOMContentLoaded', async () => {
    // Combine initial recipes with recipes from local storage and weekly recipes
    let allRecipes = [...window.initialRecipes, ...loadRecipesFromLocalStorage(), ...loadWeeklyRecipes()];

    const recipeList = document.getElementById('recipe-list');
    const weeklyPlanner = document.getElementById('weekly-planner');
    const filterBtns = document.querySelectorAll('.filter-btn');
    const generatePlanBtn = document.getElementById('generate-plan-btn');
    const clearPlanBtn = document.getElementById('clear-plan-btn');
    
    // Shopping list elements
    const generateShoppingListBtn = document.getElementById('generate-shopping-list-btn');
    const clearShoppingListBtn = document.getElementById('clear-shopping-list-btn');
    const shoppingListEmpty = document.getElementById('shopping-list-empty');
    const shoppingListItems = document.getElementById('shopping-list-items');
    const shoppingListSummary = document.getElementById('shopping-list-summary');
    const totalItemsCount = document.getElementById('total-items-count');
    
    // Modals
    const recipeModal = document.getElementById('recipe-modal');
    const modalContent = document.getElementById('modal-content');
    const addRecipeModal = document.getElementById('add-recipe-modal');
    const addRecipeBtn = document.getElementById('add-recipe-btn');
    const addModalCloseBtn = document.getElementById('add-modal-close-btn');
    const addRecipeForm = document.getElementById('add-recipe-form');

    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let weeklyPlan = loadPlanFromLocalStorage() || {};
    let shoppingList = loadShoppingListFromLocalStorage() || [];
    let selectedRecipeId = null;

    function saveRecipesToLocalStorage(recipes) {
        const userRecipes = recipes.filter(r => r.id > 1000); // Only save user-added recipes
        localStorage.setItem('mealPlannerUserRecipes', JSON.stringify(userRecipes));
    }

    function loadRecipesFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerUserRecipes')) || [];
    }

    // Weekly recipe refresh functionality
    function getWeekStartDate() {
        const now = new Date();
        const dayOfWeek = now.getDay();
        const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Monday as start of week
        return new Date(now.setDate(diff)).toDateString();
    }

    function needsWeeklyRefresh() {
        const lastRefresh = localStorage.getItem('mealPlannerLastRefresh');
        const currentWeekStart = getWeekStartDate();
        return !lastRefresh || lastRefresh !== currentWeekStart;
    }

    function saveWeeklyRecipes(recipes) {
        localStorage.setItem('mealPlannerWeeklyRecipes', JSON.stringify(recipes));
        localStorage.setItem('mealPlannerLastRefresh', getWeekStartDate());
    }

    function loadWeeklyRecipes() {
        return JSON.parse(localStorage.getItem('mealPlannerWeeklyRecipes')) || [];
    }

    // Curated pool of vegetarian recipes for weekly rotation
    const weeklyRecipePool = [
        {
            id: 2001, name: "Mediterranean Quinoa Bowl", cuisine: "Mediterranean",
            description: "A nutritious bowl with quinoa, roasted vegetables, and tahini dressing.",
            prepTime: 15, cookTime: 25,
            ingredients: ["1 cup Quinoa", "2 cups Vegetable broth", "1 Zucchini, diced", "1 Bell pepper, diced", "1 Red onion, sliced", "2 tbsp Olive oil", "1/4 cup Tahini", "2 tbsp Lemon juice", "2 cloves Garlic, minced", "1/4 cup Fresh parsley", "Salt and pepper to taste"],
            instructions: "1. Cook quinoa in vegetable broth until fluffy.\n2. Roast vegetables with olive oil at 400¬∞F for 20 minutes.\n3. Mix tahini, lemon juice, and garlic for dressing.\n4. Combine quinoa and roasted vegetables.\n5. Drizzle with tahini dressing and garnish with parsley.",
            imageUrl: "https://placehold.co/600x400/16a085/ffffff?text=Quinoa+Bowl"
        },
        {
            id: 2002, name: "Thai Green Curry with Tofu", cuisine: "Thai",
            description: "Aromatic green curry with tofu, vegetables, and coconut milk.",
            prepTime: 20, cookTime: 25,
            ingredients: ["400g Firm tofu, cubed", "400ml Coconut milk", "2 tbsp Green curry paste", "1 Eggplant, diced", "1 Bell pepper, sliced", "100g Green beans", "2 tbsp Vegetable oil", "2 tbsp Soy sauce", "1 tbsp Brown sugar", "Thai basil leaves", "Jasmine rice for serving"],
            instructions: "1. Heat oil and fry tofu until golden.\n2. Add curry paste and cook for 1 minute.\n3. Pour in coconut milk and bring to simmer.\n4. Add vegetables and cook until tender.\n5. Season with soy sauce and sugar.\n6. Garnish with Thai basil and serve with rice.",
            imageUrl: "https://placehold.co/600x400/27ae60/ffffff?text=Thai+Curry"
        },
        {
            id: 2003, name: "Mushroom Risotto", cuisine: "Italian",
            description: "Creamy arborio rice with mixed mushrooms and Parmesan cheese.",
            prepTime: 10, cookTime: 30,
            ingredients: ["1.5 cups Arborio rice", "4 cups Vegetable stock", "300g Mixed mushrooms, sliced", "1 Onion, diced", "3 cloves Garlic, minced", "1/2 cup White wine", "1/2 cup Parmesan cheese", "3 tbsp Butter", "2 tbsp Olive oil", "Fresh thyme", "Salt and pepper"],
            instructions: "1. Heat stock in a separate pan.\n2. Saut√© mushrooms until golden, set aside.\n3. Cook onion and garlic in oil until soft.\n4. Add rice and stir for 2 minutes.\n5. Add wine and stir until absorbed.\n6. Add stock gradually, stirring constantly.\n7. Fold in mushrooms, butter, and Parmesan.",
            imageUrl: "https://placehold.co/600x400/f39c12/ffffff?text=Mushroom+Risotto"
        },
        {
            id: 2004, name: "Black Bean Tacos", cuisine: "Mexican",
            description: "Spiced black beans with fresh toppings in soft tortillas.",
            prepTime: 15, cookTime: 15,
            ingredients: ["2 cans Black beans, drained", "8 Soft tortillas", "1 Onion, diced", "2 cloves Garlic, minced", "1 tsp Cumin", "1 tsp Chili powder", "1 Avocado, sliced", "1 cup Shredded lettuce", "1 Tomato, diced", "1/2 cup Cilantro", "Lime wedges", "Hot sauce"],
            instructions: "1. Saut√© onion and garlic until soft.\n2. Add black beans, cumin, and chili powder.\n3. Cook until heated through and slightly mashed.\n4. Warm tortillas in a dry pan.\n5. Fill tortillas with bean mixture.\n6. Top with avocado, lettuce, tomato, and cilantro.\n7. Serve with lime wedges and hot sauce.",
            imageUrl: "https://placehold.co/600x400/e67e22/ffffff?text=Black+Bean+Tacos"
        },
        {
            id: 2005, name: "Palak Paneer", cuisine: "Indian",
            description: "Creamy spinach curry with cottage cheese cubes.",
            prepTime: 20, cookTime: 25,
            ingredients: ["500g Fresh spinach", "250g Paneer, cubed", "2 Onions, chopped", "3 Tomatoes, chopped", "4 cloves Garlic", "1 inch Ginger", "2 Green chilies", "1 tsp Cumin seeds", "1/2 tsp Garam masala", "1/4 cup Heavy cream", "2 tbsp Oil", "Salt to taste"],
            instructions: "1. Blanch spinach and blend to a smooth puree.\n2. Fry paneer cubes until golden, set aside.\n3. Make paste of onion, garlic, ginger, and chilies.\n4. Cook paste until oil separates.\n5. Add tomatoes and cook until soft.\n6. Add spinach puree and simmer.\n7. Add paneer, cream, and garam masala.",
            imageUrl: "https://placehold.co/600x400/2ecc71/ffffff?text=Palak+Paneer"
        },
        {
            id: 2006, name: "Ratatouille", cuisine: "Mediterranean",
            description: "Traditional French vegetable stew with herbs de Provence.",
            prepTime: 25, cookTime: 40,
            ingredients: ["2 Eggplants, diced", "2 Zucchini, sliced", "2 Bell peppers, chopped", "4 Tomatoes, chopped", "1 Large onion, sliced", "4 cloves Garlic, minced", "1/4 cup Olive oil", "2 tsp Herbs de Provence", "1 Bay leaf", "Fresh basil", "Salt and pepper"],
            instructions: "1. Salt eggplant and let drain for 30 minutes.\n2. Saut√© onion and garlic in olive oil.\n3. Add bell peppers and cook until soft.\n4. Add eggplant and zucchini.\n5. Add tomatoes, herbs, and bay leaf.\n6. Simmer covered for 30 minutes.\n7. Garnish with fresh basil before serving.",
            imageUrl: "https://placehold.co/600x400/9b59b6/ffffff?text=Ratatouille"
        },
        {
            id: 2007, name: "Chickpea Curry", cuisine: "Indian",
            description: "Hearty chickpea curry with aromatic spices and tomatoes.",
            prepTime: 15, cookTime: 30,
            ingredients: ["2 cans Chickpeas, drained", "2 Onions, chopped", "4 Tomatoes, chopped", "3 cloves Garlic, minced", "1 inch Ginger, minced", "2 tsp Coriander powder", "1 tsp Turmeric", "1 tsp Cumin powder", "1/2 tsp Red chili powder", "2 tbsp Oil", "Cilantro for garnish"],
            instructions: "1. Heat oil and saut√© onions until golden.\n2. Add garlic and ginger, cook for 1 minute.\n3. Add all spice powders and cook for 30 seconds.\n4. Add tomatoes and cook until soft.\n5. Add chickpeas and water as needed.\n6. Simmer for 20 minutes until thick.\n7. Garnish with cilantro and serve.",
            imageUrl: "https://placehold.co/600x400/e74c3c/ffffff?text=Chickpea+Curry"
        },
        {
            id: 2008, name: "Vegetable Pad Thai", cuisine: "Thai",
            description: "Stir-fried rice noodles with vegetables in tangy tamarind sauce.",
            prepTime: 20, cookTime: 15,
            ingredients: ["200g Rice noodles", "2 cups Mixed vegetables", "2 Eggs, beaten", "3 tbsp Tamarind paste", "2 tbsp Soy sauce", "2 tbsp Brown sugar", "2 cloves Garlic, minced", "2 tbsp Vegetable oil", "1/4 cup Peanuts, crushed", "Bean sprouts", "Lime wedges", "Cilantro"],
            instructions: "1. Soak rice noodles until soft.\n2. Mix tamarind paste, soy sauce, and brown sugar.\n3. Heat oil and scramble eggs, set aside.\n4. Stir-fry garlic and vegetables.\n5. Add noodles and sauce, toss well.\n6. Add eggs and bean sprouts.\n7. Garnish with peanuts, cilantro, and lime.",
            imageUrl: "https://placehold.co/600x400/f1c40f/ffffff?text=Pad+Thai"
        },
        {
            id: 2009, name: "Caprese Stuffed Portobello", cuisine: "Italian",
            description: "Grilled portobello mushrooms stuffed with mozzarella and tomatoes.",
            prepTime: 15, cookTime: 20,
            ingredients: ["4 Large portobello mushrooms", "8 oz Fresh mozzarella, sliced", "2 Large tomatoes, sliced", "1/4 cup Fresh basil", "3 tbsp Balsamic vinegar", "2 tbsp Olive oil", "2 cloves Garlic, minced", "Salt and pepper", "Fresh arugula for serving"],
            instructions: "1. Remove mushroom stems and scrape out gills.\n2. Mix olive oil, garlic, salt, and pepper.\n3. Brush mushrooms with oil mixture.\n4. Grill mushrooms gill-side down for 5 minutes.\n5. Flip and fill with mozzarella and tomatoes.\n6. Grill until cheese melts.\n7. Top with basil and drizzle with balsamic.",
            imageUrl: "https://placehold.co/600x400/34495e/ffffff?text=Caprese+Portobello"
        },
        {
            id: 2010, name: "Moroccan Vegetable Tagine", cuisine: "Mediterranean",
            description: "Slow-cooked vegetables with warm spices and dried fruits.",
            prepTime: 20, cookTime: 45,
            ingredients: ["2 Eggplants, cubed", "3 Carrots, sliced", "2 Zucchini, chunked", "1 can Chickpeas", "1/2 cup Dried apricots", "1 Onion, sliced", "3 cloves Garlic, minced", "2 tsp Cinnamon", "1 tsp Ginger powder", "1 tsp Turmeric", "2 tbsp Olive oil", "Couscous for serving"],
            instructions: "1. Heat oil and saut√© onion until soft.\n2. Add garlic and spices, cook for 1 minute.\n3. Add eggplant and carrots, cook for 10 minutes.\n4. Add zucchini, chickpeas, and apricots.\n5. Add water and simmer covered for 30 minutes.\n6. Check seasoning and adjust.\n7. Serve over fluffy couscous.",
            imageUrl: "https://placehold.co/600x400/d35400/ffffff?text=Moroccan+Tagine"
        }
    ];

    function getWeeklyRecipeSet() {
        // Use week number to deterministically select recipes
        const now = new Date();
        const startOfYear = new Date(now.getFullYear(), 0, 1);
        const weekNumber = Math.ceil(((now - startOfYear) / 86400000 + startOfYear.getDay() + 1) / 7);

        // Create a deterministic shuffle based on week number
        const shuffled = [...weeklyRecipePool];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = (weekNumber * 13 + i * 7) % (i + 1); // Deterministic pseudo-random
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }

        // Return 6 recipes for the week
        return shuffled.slice(0, 6);
    }

    async function fetchVegetarianRecipes() {
        // Return curated weekly recipes instead of API call
        return getWeeklyRecipeSet();
    }

    async function refreshWeeklyRecipes() {
        if (needsWeeklyRefresh()) {
            const refreshIndicator = document.getElementById('refresh-indicator');
            if (refreshIndicator) {
                refreshIndicator.style.display = 'block';
                refreshIndicator.textContent = 'Fetching new recipes...';
            }

            const newRecipes = await fetchVegetarianRecipes();
            if (newRecipes.length > 0) {
                saveWeeklyRecipes(newRecipes);
                // Update allRecipes with new weekly recipes
                allRecipes = [...window.initialRecipes, ...loadRecipesFromLocalStorage(), ...newRecipes];
                renderRecipes();

                if (refreshIndicator) {
                    refreshIndicator.textContent = `‚ú® ${newRecipes.length} new recipes added this week!`;
                    setTimeout(() => {
                        refreshIndicator.style.display = 'none';
                    }, 3000);
                }
            } else {
                if (refreshIndicator) {
                    refreshIndicator.style.display = 'none';
                }
            }
        }
    }

    function savePlanToLocalStorage() {
        localStorage.setItem('mealPlannerPlan', JSON.stringify(weeklyPlan));
    }

    function loadPlanFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerPlan'));
    }

    function saveShoppingListToLocalStorage() {
        localStorage.setItem('mealPlannerShoppingList', JSON.stringify(shoppingList));
    }

    function loadShoppingListFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerShoppingList'));
    }

    function renderRecipes(filter = 'all') {
        recipeList.innerHTML = '';
        const filteredRecipes = filter === 'all' ? allRecipes : allRecipes.filter(recipe => recipe.cuisine === filter);
        
        filteredRecipes.forEach(recipe => {
            const recipeCard = document.createElement('div');
            recipeCard.className = 'p-3 sm:p-4 border border-gray-200 rounded-lg flex gap-3 sm:gap-4 items-center bg-white shadow-sm hover:shadow-md cursor-pointer transition-all duration-200';
            recipeCard.dataset.recipeId = recipe.id;
            
            recipeCard.innerHTML = `
                <img src="${recipe.imageUrl || 'https://placehold.co/80x80/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-16 h-16 sm:w-20 sm:h-20 rounded-md object-cover flex-shrink-0">
                <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-gray-800 text-sm sm:text-base leading-tight mb-1 truncate">${recipe.name}</h3>
                    <p class="text-xs sm:text-sm text-gray-500">${recipe.cuisine}</p>
                    <div class="flex gap-1 text-xs text-gray-400 mt-1">
                        <span>${recipe.prepTime}m prep</span>
                        <span>‚Ä¢</span>
                        <span>${recipe.cookTime}m cook</span>
                    </div>
                </div>
                <button class="view-btn bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 py-1 sm:py-1.5 rounded-md text-xs sm:text-sm font-medium transition-colors flex-shrink-0" data-recipe-id="${recipe.id}">View</button>
            `;
            recipeList.appendChild(recipeCard);
        });
    }

    function renderPlanner() {
        weeklyPlanner.innerHTML = '';
        days.forEach(day => {
            // Create day row container
            const dayRow = document.createElement('div');
            dayRow.className = 'bg-gray-100 p-3 sm:p-4 rounded-lg';
            
            // Day header
            const dayHeader = document.createElement('h3');
            dayHeader.className = 'font-bold text-sm sm:text-base text-gray-700 mb-3 text-center lg:text-left';
            dayHeader.textContent = day;
            dayRow.appendChild(dayHeader);
            
            // Meals container - responsive: vertical on mobile, horizontal on desktop
            const mealsContainer = document.createElement('div');
            mealsContainer.className = 'flex flex-col lg:flex-row gap-3 lg:gap-4';
            
            ['Lunch', 'Dinner'].forEach(meal => {
                const mealSlotId = `${day}-${meal}`;
                const recipeId = weeklyPlan[mealSlotId];
                const recipe = recipeId ? allRecipes.find(r => r.id == recipeId) : null;
                
                const mealSlot = document.createElement('div');
                mealSlot.className = 'meal-slot meal-slot-clickable bg-white p-3 rounded-lg min-h-[80px] lg:min-h-[100px] flex flex-col justify-center items-center text-center transition-all duration-200 hover:shadow-sm border border-gray-100 lg:flex-1';
                mealSlot.dataset.slotId = mealSlotId;

                if (recipe) {
                    mealSlot.innerHTML = `
                        <p class="text-sm font-semibold text-gray-800 leading-tight mb-1 line-clamp-2">${recipe.name}</p>
                        <p class="text-xs text-gray-500 mb-2">${meal}</p>
                        <div class="flex gap-2">
                            <button class="view-recipe-btn bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 rounded transition-colors" data-recipe-id="${recipe.id}">View</button>
                            <button class="remove-btn bg-red-50 hover:bg-red-100 text-red-600 text-xs px-2 py-1 rounded transition-colors" data-slot-id="${mealSlotId}">Remove</button>
                        </div>
                    `;
                } else {
                    mealSlot.innerHTML = `<span class="text-gray-400 text-sm">${meal}</span>`;
                }
                mealsContainer.appendChild(mealSlot);
            });
            
            dayRow.appendChild(mealsContainer);
            weeklyPlanner.appendChild(dayRow);
        });
    }

    function generateShoppingList() {
        // Get all recipes from the weekly plan
        const plannedRecipeIds = Object.values(weeklyPlan).filter(id => id);
        const plannedRecipes = plannedRecipeIds.map(id => allRecipes.find(r => r.id == id)).filter(r => r);
        
        if (plannedRecipes.length === 0) {
            alert('No recipes in your weekly plan. Add some recipes first!');
            return;
        }

        // Collect all ingredients
        const allIngredients = [];
        plannedRecipes.forEach(recipe => {
            if (recipe.ingredients) {
                recipe.ingredients.forEach(ingredient => {
                    allIngredients.push({
                        name: ingredient,
                        recipe: recipe.name,
                        checked: false
                    });
                });
            }
        });

        // Group similar ingredients (basic grouping by first few words)
        const groupedIngredients = {};
        allIngredients.forEach(item => {
            // Simple grouping by cleaning ingredient names
            let key = item.name.toLowerCase()
                .replace(/^\d+\s*(cups?|tbsp|tsp|oz|lbs?|kg|grams?|ml|liters?)?\s*/, '') // Remove quantities
                .replace(/,.*$/, '') // Remove everything after comma
                .trim();
            
            if (!groupedIngredients[key]) {
                groupedIngredients[key] = [];
            }
            groupedIngredients[key].push(item);
        });

        // Create shopping list items
        shoppingList = [];
        Object.keys(groupedIngredients).forEach(key => {
            const items = groupedIngredients[key];
            const recipes = [...new Set(items.map(item => item.recipe))];
            shoppingList.push({
                ingredient: items[0].name, // Use the first occurrence as the ingredient name
                recipes: recipes,
                checked: false
            });
        });

        saveShoppingListToLocalStorage();
        renderShoppingList();
    }

    function renderShoppingList() {
        if (shoppingList.length === 0) {
            shoppingListEmpty.style.display = 'block';
            shoppingListItems.style.display = 'none';
            shoppingListSummary.style.display = 'none';
            return;
        }

        shoppingListEmpty.style.display = 'none';
        shoppingListItems.style.display = 'block';
        shoppingListSummary.style.display = 'block';

        shoppingListItems.innerHTML = '';
        
        shoppingList.forEach((item, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = `flex items-start gap-3 p-3 rounded-lg border ${item.checked ? 'bg-gray-50 opacity-60' : 'bg-white'}`;
            
            itemDiv.innerHTML = `
                <input type="checkbox" ${item.checked ? 'checked' : ''} 
                       class="mt-1 rounded border-gray-300 text-purple-600 focus:ring-purple-500" 
                       data-index="${index}">
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium ${item.checked ? 'line-through text-gray-500' : 'text-gray-800'}">${item.ingredient}</p>
                    <p class="text-xs text-gray-500 mt-1">For: ${item.recipes.join(', ')}</p>
                </div>
                <button class="kroger-btn bg-blue-600 hover:bg-blue-700 text-white text-xs px-2 py-1 rounded-md transition-colors flex-shrink-0 ml-2" 
                        data-ingredient="${item.ingredient}" 
                        title="Search on Kroger">
                    üõí Kroger
                </button>
            `;
            
            shoppingListItems.appendChild(itemDiv);
        });

        // Update summary
        const totalItems = shoppingList.length;
        const checkedItems = shoppingList.filter(item => item.checked).length;
        totalItemsCount.textContent = `${checkedItems}/${totalItems}`;
    }

    function clearShoppingList() {
        shoppingList = [];
        saveShoppingListToLocalStorage();
        renderShoppingList();
    }

    function searchKroger(ingredient) {
        // Clean up the ingredient name for better search results
        const searchTerm = ingredient
            .replace(/^\d+\s*(cups?|tbsp|tsp|oz|lbs?|kg|grams?|ml|liters?)?\s*/, '') // Remove quantities
            .replace(/,.*$/, '') // Remove everything after comma
            .replace(/\(.*?\)/g, '') // Remove parentheses and contents
            .trim();
        
        // Encode the search term for URL
        const encodedSearch = encodeURIComponent(searchTerm);
        
        // Open Kroger search in a new tab
        const krogerUrl = `https://www.kroger.com/search?query=${encodedSearch}`;
        window.open(krogerUrl, '_blank');
    }
    
    function showRecipeModal(recipeId) {
        const recipe = allRecipes.find(r => r.id == recipeId);
        if (!recipe) return;

        modalContent.innerHTML = `
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 leading-tight flex-1 pr-4">${recipe.name}</h2>
                    <button id="modal-close-btn" class="text-2xl sm:text-3xl font-light text-gray-500 hover:text-gray-800 p-1 flex-shrink-0">&times;</button>
                </div>
                <img src="${recipe.imageUrl || 'https://placehold.co/600x400/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-full h-48 sm:h-64 object-cover rounded-lg mb-4">
                <p class="text-gray-600 mb-4 text-sm sm:text-base leading-relaxed">${recipe.description}</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6 text-center">
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Cuisine</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.cuisine}</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Prep Time</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.prepTime} mins</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Cook Time</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.cookTime} mins</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 text-gray-800 border-b border-gray-200 pb-2">Ingredients</h3>
                        <ul class="list-none space-y-2 text-gray-700 text-sm sm:text-base">
                            ${recipe.ingredients.map(ing => `<li class="flex items-start"><span class="text-green-500 mr-2">‚Ä¢</span><span>${ing}</span></li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 text-gray-800 border-b border-gray-200 pb-2">Instructions</h3>
                        <div class="space-y-3 text-gray-700 text-sm sm:text-base leading-relaxed whitespace-pre-line">${recipe.instructions}</div>
                    </div>
                </div>
            </div>
        `;
        recipeModal.classList.remove('hidden');
        setTimeout(() => modalContent.classList.add('modal-enter-active'), 10);
        document.getElementById('modal-close-btn').addEventListener('click', closeRecipeModal);
    }
    
    function closeRecipeModal() {
        modalContent.classList.remove('modal-enter-active');
        modalContent.classList.add('modal-exit-active');
        setTimeout(() => {
            recipeModal.classList.add('hidden');
            modalContent.classList.remove('modal-exit-active');
        }, 300);
    }

    function handleFilterClick(e) {
        filterBtns.forEach(btn => {
            btn.classList.remove('bg-emerald-500', 'text-white');
            btn.classList.add('bg-gray-200', 'text-gray-700');
        });
        e.target.classList.add('bg-emerald-500', 'text-white');
        e.target.classList.remove('bg-gray-200', 'text-gray-700');
        renderRecipes(e.target.dataset.cuisine);
    }

    function generateRandomPlan() {
        if (allRecipes.length === 0) {
            alert("There are no recipes to generate a plan from. Please add some recipes first!");
            return;
        }
        weeklyPlan = {};
        days.forEach(day => {
            ['Lunch', 'Dinner'].forEach(meal => {
                const randomRecipe = allRecipes[Math.floor(Math.random() * allRecipes.length)];
                weeklyPlan[`${day}-${meal}`] = randomRecipe.id;
            });
        });
        renderPlanner();
        savePlanToLocalStorage();
    }
    
    // Event Listeners
    filterBtns.forEach(btn => btn.addEventListener('click', handleFilterClick));
    generatePlanBtn.addEventListener('click', generateRandomPlan);
    clearPlanBtn.addEventListener('click', () => {
        weeklyPlan = {};
        renderPlanner();
        savePlanToLocalStorage();
    });

    // Manual refresh button
    document.getElementById('refresh-recipes-btn').addEventListener('click', async () => {
        const refreshBtn = document.getElementById('refresh-recipes-btn');
        const originalText = refreshBtn.innerHTML;
        refreshBtn.innerHTML = '‚è≥ Loading...';
        refreshBtn.disabled = true;

        // Force fetch new recipes regardless of week
        const newRecipes = await fetchVegetarianRecipes();
        if (newRecipes.length > 0) {
            saveWeeklyRecipes(newRecipes);
            allRecipes = [...window.initialRecipes, ...loadRecipesFromLocalStorage(), ...newRecipes];
            renderRecipes();

            refreshBtn.innerHTML = '‚úÖ Done!';
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }, 2000);
        } else {
            refreshBtn.innerHTML = '‚ùå Failed';
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }, 2000);
        }
    });
    
    // Shopping list event listeners
    generateShoppingListBtn.addEventListener('click', generateShoppingList);
    clearShoppingListBtn.addEventListener('click', clearShoppingList);
    
    // Shopping list item interactions
    shoppingListItems.addEventListener('click', (e) => {
        if (e.target.type === 'checkbox') {
            const index = parseInt(e.target.dataset.index);
            shoppingList[index].checked = e.target.checked;
            saveShoppingListToLocalStorage();
            renderShoppingList();
        } else if (e.target.classList.contains('kroger-btn')) {
            const ingredient = e.target.dataset.ingredient;
            searchKroger(ingredient);
        }
    });


    recipeModal.addEventListener('click', (e) => {
        if (e.target === recipeModal) {
            closeRecipeModal();
        }
    });

    weeklyPlanner.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-btn')) {
            delete weeklyPlan[e.target.dataset.slotId];
            renderPlanner();
            savePlanToLocalStorage();
        } else if (e.target.classList.contains('view-recipe-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        } else {
            // Check if clicking on an empty meal slot
            const mealSlot = e.target.closest('.meal-slot');
            if (mealSlot && mealSlot.dataset.slotId) {
                const slotId = mealSlot.dataset.slotId;
                // Only add recipe if a recipe is selected
                if (selectedRecipeId) {
                    addRecipeToSlot(slotId);
                }
            }
        }
    });

    // Click-to-Add Logic
    function selectRecipe(recipeId) {
        selectedRecipeId = recipeId;
        // Update visual selection
        document.querySelectorAll('.recipe-selected').forEach(card => {
            card.classList.remove('recipe-selected');
        });
        const selectedCard = document.querySelector(`[data-recipe-id="${recipeId}"]`);
        if (selectedCard) {
            selectedCard.classList.add('recipe-selected');
        }
    }

    function addRecipeToSlot(slotId) {
        if (selectedRecipeId) {
            weeklyPlan[slotId] = selectedRecipeId;
            renderPlanner();
            savePlanToLocalStorage();
        }
    }

    // Recipe selection event listener
    recipeList.addEventListener('click', (e) => {
        const recipeCard = e.target.closest('[data-recipe-id]');
        if (recipeCard && !e.target.classList.contains('view-btn')) {
            selectRecipe(recipeCard.dataset.recipeId);
        }
        if (e.target.classList.contains('view-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        }
    });
    
    // Add recipe modal logic
    addRecipeBtn.addEventListener('click', () => {
        addRecipeForm.reset();
        addRecipeModal.classList.remove('hidden');
    });

    addModalCloseBtn.addEventListener('click', () => {
        addRecipeModal.classList.add('hidden');
    });

    addRecipeModal.addEventListener('click', (e) => {
        if (e.target === addRecipeModal) {
            addRecipeModal.classList.add('hidden');
        }
    });
    
    addRecipeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const newRecipe = {
            id: Date.now(), // Simple unique ID
            name: formData.get('name'),
            cuisine: formData.get('cuisine'),
            description: formData.get('description'),
            prepTime: parseInt(formData.get('prepTime')),
            cookTime: parseInt(formData.get('cookTime')),
            ingredients: formData.get('ingredients').split('\n').filter(i => i.trim() !== ''),
            instructions: formData.get('instructions'),
            imageUrl: `https://placehold.co/600x400/8b5cf6/ffffff?text=${formData.get('name').replace(/\s/g, '+')}`
        };
        
        allRecipes.push(newRecipe);
        saveRecipesToLocalStorage(allRecipes);
        renderRecipes(document.querySelector('.filter-btn.bg-emerald-500').dataset.cuisine);
        addRecipeModal.classList.add('hidden');
    });


    // Initial render
    renderRecipes();
    renderPlanner();
    renderShoppingList();

    // Check for weekly recipe refresh
    refreshWeeklyRecipes();
});
</script>

</body>
</html>

