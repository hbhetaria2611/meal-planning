<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeggiPlan: Vegetarian Meal Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Tailwind gray-100 */
        }
        /* Style for the element being dragged */
        .dragging {
            opacity: 0.5;
            border: 2px dashed #fbbf24; /* Tailwind amber-400 */
        }
        /* Style for the drop zone when dragging over it */
        .drag-over {
            background-color: #fef3c7; /* Tailwind amber-100 */
            transform: scale(1.02);
            transition: transform 0.2s, background-color 0.2s;
        }
        /* Hide the scrollbar but keep it scrollable */
        #recipe-list::-webkit-scrollbar {
            width: 8px;
        }
        #recipe-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb {
            background: #d1d5db; /* Tailwind gray-300 */
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* Tailwind gray-400 */
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl lg:text-5xl font-bold text-gray-800">VeggiPlan Meal Planner</h1>
            <p class="text-gray-600 mt-2">Plan your vegetarian week with delicious Indian, Italian, Mexican, and Gujarati recipes!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Weekly Planner Section -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                    <h2 class="text-2xl font-bold">Your Weekly Plan</h2>
                    <div class="flex gap-2">
                        <button id="generate-plan-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">âœ¨ Generate Random Plan</button>
                        <button id="clear-plan-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Clear Plan</button>
                    </div>
                </div>
                <div id="weekly-planner" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                    <!-- Day columns will be generated by JS -->
                </div>
            </div>

            <!-- Recipe Library Section -->
            <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4">Recipe Library</h2>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="filter-btn bg-emerald-500 text-white px-4 py-2 rounded-full text-sm" data-cuisine="all">All</button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm" data-cuisine="Breakfast">Breakfast</button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm" data-cuisine="Indian">Indian</button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm" data-cuisine="Italian">Italian</button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm" data-cuisine="Mexican">Mexican</button>
                    <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm" data-cuisine="Gujarati">Gujarati</button>
                </div>
                <div id="recipe-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- Recipe cards will be generated by JS -->
                </div>
                <button id="add-recipe-btn" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">+ Add New Recipe</button>
            </div>
        </div>
    </div>

    <!-- Recipe Detail Modal -->
    <div id="recipe-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div id="modal-content" class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
             <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Add Recipe Modal -->
    <div id="add-recipe-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content transform scale-95 bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-2xl font-bold">Add a New Recipe</h3>
                <button id="add-modal-close-btn" class="text-3xl font-light text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <form id="add-recipe-form" class="p-6 space-y-4">
                <input type="text" name="name" placeholder="Recipe Name" class="w-full p-3 border rounded-lg" required>
                <select name="cuisine" class="w-full p-3 border rounded-lg" required>
                    <option value="" disabled selected>Select Cuisine</option>
                    <option value="Breakfast">Breakfast</option>
                    <option value="Indian">Indian</option>
                    <option value="Italian">Italian</option>
                    <option value="Mexican">Mexican</option>
                    <option value="Gujarati">Gujarati</option>
                </select>
                <textarea name="description" placeholder="Short description" class="w-full p-3 border rounded-lg" rows="2" required></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" name="prepTime" placeholder="Prep time (mins)" class="w-full p-3 border rounded-lg" required>
                    <input type="number" name="cookTime" placeholder="Cook time (mins)" class="w-full p-3 border rounded-lg" required>
                </div>
                <textarea name="ingredients" placeholder="Ingredients (one per line)" class="w-full p-3 border rounded-lg" rows="5" required></textarea>
                <textarea name="instructions" placeholder="Instructions (use '1. Step one...' format)" class="w-full p-3 border rounded-lg" rows="6" required></textarea>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">Save Recipe</button>
            </form>
        </div>
    </div>

<script src="recipes.js"></script>
<script>
// --- RECIPE DATABASE ---
// Recipes are now loaded from recipes.js file
// The recipes will be available as window.initialRecipes

document.addEventListener('DOMContentLoaded', () => {
    // Combine initial recipes with recipes from local storage
    let allRecipes = [...window.initialRecipes, ...loadRecipesFromLocalStorage()];

    const recipeList = document.getElementById('recipe-list');
    const weeklyPlanner = document.getElementById('weekly-planner');
    const filterBtns = document.querySelectorAll('.filter-btn');
    const generatePlanBtn = document.getElementById('generate-plan-btn');
    const clearPlanBtn = document.getElementById('clear-plan-btn');
    
    // Modals
    const recipeModal = document.getElementById('recipe-modal');
    const modalContent = document.getElementById('modal-content');
    const addRecipeModal = document.getElementById('add-recipe-modal');
    const addRecipeBtn = document.getElementById('add-recipe-btn');
    const addModalCloseBtn = document.getElementById('add-modal-close-btn');
    const addRecipeForm = document.getElementById('add-recipe-form');

    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let weeklyPlan = loadPlanFromLocalStorage() || {};

    function saveRecipesToLocalStorage(recipes) {
        const userRecipes = recipes.filter(r => r.id > 1000); // Only save user-added recipes
        localStorage.setItem('mealPlannerUserRecipes', JSON.stringify(userRecipes));
    }

    function loadRecipesFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerUserRecipes')) || [];
    }

    function savePlanToLocalStorage() {
        localStorage.setItem('mealPlannerPlan', JSON.stringify(weeklyPlan));
    }

    function loadPlanFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerPlan'));
    }

    function renderRecipes(filter = 'all') {
        recipeList.innerHTML = '';
        const filteredRecipes = filter === 'all' ? allRecipes : allRecipes.filter(recipe => recipe.cuisine === filter);
        
        filteredRecipes.forEach(recipe => {
            const recipeCard = document.createElement('div');
            recipeCard.className = 'p-4 border rounded-lg flex gap-4 items-center bg-white shadow-sm cursor-grab active:cursor-grabbing';
            recipeCard.setAttribute('draggable', 'true');
            recipeCard.dataset.recipeId = recipe.id;
            
            recipeCard.innerHTML = `
                <img src="${recipe.imageUrl || 'https://placehold.co/80x80/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-20 h-20 rounded-md object-cover">
                <div class="flex-1">
                    <h3 class="font-bold text-gray-800">${recipe.name}</h3>
                    <p class="text-sm text-gray-500">${recipe.cuisine}</p>
                </div>
                <button class="view-btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-3 py-1 rounded-md text-sm" data-recipe-id="${recipe.id}">View</button>
            `;
            recipeList.appendChild(recipeCard);
        });
    }

    function renderPlanner() {
        weeklyPlanner.innerHTML = '';
        days.forEach(day => {
            const dayCol = document.createElement('div');
            dayCol.className = 'bg-gray-100 p-3 rounded-lg flex flex-col gap-4';
            dayCol.innerHTML = `<h3 class="font-bold text-center">${day}</h3>`;

            ['Lunch', 'Dinner'].forEach(meal => {
                const mealSlotId = `${day}-${meal}`;
                const recipeId = weeklyPlan[mealSlotId];
                const recipe = recipeId ? allRecipes.find(r => r.id == recipeId) : null;
                
                const mealSlot = document.createElement('div');
                mealSlot.className = 'meal-slot bg-white p-2 rounded-lg min-h-[80px] flex flex-col justify-center items-center text-center transition-all duration-200';
                mealSlot.dataset.slotId = mealSlotId;

                if (recipe) {
                    mealSlot.innerHTML = `
                        <p class="text-sm font-semibold">${recipe.name}</p>
                        <p class="text-xs text-gray-500">${meal}</p>
                        <div class="flex gap-1 mt-1">
                            <button class="view-recipe-btn bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 rounded" data-recipe-id="${recipe.id}">View</button>
                            <button class="remove-btn text-red-500 text-xs px-2 py-1" data-slot-id="${mealSlotId}">Remove</button>
                        </div>
                    `;
                } else {
                    mealSlot.innerHTML = `<span class="text-gray-400 text-sm">${meal}</span>`;
                }
                dayCol.appendChild(mealSlot);
            });
            weeklyPlanner.appendChild(dayCol);
        });
    }
    
    function showRecipeModal(recipeId) {
        const recipe = allRecipes.find(r => r.id == recipeId);
        if (!recipe) return;

        modalContent.innerHTML = `
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <h2 class="text-3xl font-bold mb-4">${recipe.name}</h2>
                    <button id="modal-close-btn" class="text-3xl font-light text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <img src="${recipe.imageUrl || 'https://placehold.co/600x400/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-full h-64 object-cover rounded-lg mb-4">
                <p class="text-gray-600 mb-4">${recipe.description}</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 text-center">
                    <div class="bg-gray-100 p-2 rounded-lg"><strong>Cuisine:</strong> ${recipe.cuisine}</div>
                    <div class="bg-gray-100 p-2 rounded-lg"><strong>Prep Time:</strong> ${recipe.prepTime} mins</div>
                    <div class="bg-gray-100 p-2 rounded-lg"><strong>Cook Time:</strong> ${recipe.cookTime} mins</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 border-b pb-1">Ingredients</h3>
                        <ul class="list-disc list-inside space-y-1 text-gray-700">
                            ${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 border-b pb-1">Instructions</h3>
                        <div class="space-y-2 text-gray-700 whitespace-pre-line">${recipe.instructions}</div>
                    </div>
                </div>
            </div>
        `;
        recipeModal.classList.remove('hidden');
        setTimeout(() => modalContent.classList.add('modal-enter-active'), 10);
        document.getElementById('modal-close-btn').addEventListener('click', closeRecipeModal);
    }
    
    function closeRecipeModal() {
        modalContent.classList.remove('modal-enter-active');
        modalContent.classList.add('modal-exit-active');
        setTimeout(() => {
            recipeModal.classList.add('hidden');
            modalContent.classList.remove('modal-exit-active');
        }, 300);
    }

    function handleFilterClick(e) {
        filterBtns.forEach(btn => {
            btn.classList.remove('bg-emerald-500', 'text-white');
            btn.classList.add('bg-gray-200', 'text-gray-700');
        });
        e.target.classList.add('bg-emerald-500', 'text-white');
        e.target.classList.remove('bg-gray-200', 'text-gray-700');
        renderRecipes(e.target.dataset.cuisine);
    }

    function generateRandomPlan() {
        if (allRecipes.length === 0) {
            alert("There are no recipes to generate a plan from. Please add some recipes first!");
            return;
        }
        weeklyPlan = {};
        days.forEach(day => {
            ['Lunch', 'Dinner'].forEach(meal => {
                const randomRecipe = allRecipes[Math.floor(Math.random() * allRecipes.length)];
                weeklyPlan[`${day}-${meal}`] = randomRecipe.id;
            });
        });
        renderPlanner();
        savePlanToLocalStorage();
    }
    
    // Event Listeners
    filterBtns.forEach(btn => btn.addEventListener('click', handleFilterClick));
    generatePlanBtn.addEventListener('click', generateRandomPlan);
    clearPlanBtn.addEventListener('click', () => {
        weeklyPlan = {};
        renderPlanner();
        savePlanToLocalStorage();
    });

    recipeList.addEventListener('click', (e) => {
        if (e.target.classList.contains('view-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        }
    });

    recipeModal.addEventListener('click', (e) => {
        if (e.target === recipeModal) {
            closeRecipeModal();
        }
    });

    weeklyPlanner.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-btn')) {
            delete weeklyPlan[e.target.dataset.slotId];
            renderPlanner();
            savePlanToLocalStorage();
        }
        if (e.target.classList.contains('view-recipe-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        }
    });

    // Drag and Drop Logic
    let draggedItemId = null;

    recipeList.addEventListener('dragstart', (e) => {
        if (e.target.dataset.recipeId) {
            draggedItemId = e.target.dataset.recipeId;
            e.target.classList.add('dragging');
        }
    });

    recipeList.addEventListener('dragend', (e) => {
        if (e.target.dataset.recipeId) {
            draggedItemId = null;
            e.target.classList.remove('dragging');
        }
    });
    
    weeklyPlanner.addEventListener('dragover', (e) => {
        e.preventDefault();
        const slot = e.target.closest('.meal-slot');
        if (slot) {
            slot.classList.add('drag-over');
        }
    });
    
    weeklyPlanner.addEventListener('dragleave', (e) => {
        const slot = e.target.closest('.meal-slot');
        if (slot) {
            slot.classList.remove('drag-over');
        }
    });

    weeklyPlanner.addEventListener('drop', (e) => {
        e.preventDefault();
        const slot = e.target.closest('.meal-slot');
        if (slot && draggedItemId) {
            slot.classList.remove('drag-over');
            weeklyPlan[slot.dataset.slotId] = draggedItemId;
            renderPlanner();
            savePlanToLocalStorage();
        }
    });
    
    // Add recipe modal logic
    addRecipeBtn.addEventListener('click', () => {
        addRecipeForm.reset();
        addRecipeModal.classList.remove('hidden');
    });

    addModalCloseBtn.addEventListener('click', () => {
        addRecipeModal.classList.add('hidden');
    });

    addRecipeModal.addEventListener('click', (e) => {
        if (e.target === addRecipeModal) {
            addRecipeModal.classList.add('hidden');
        }
    });
    
    addRecipeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const newRecipe = {
            id: Date.now(), // Simple unique ID
            name: formData.get('name'),
            cuisine: formData.get('cuisine'),
            description: formData.get('description'),
            prepTime: parseInt(formData.get('prepTime')),
            cookTime: parseInt(formData.get('cookTime')),
            ingredients: formData.get('ingredients').split('\n').filter(i => i.trim() !== ''),
            instructions: formData.get('instructions'),
            imageUrl: `https://placehold.co/600x400/8b5cf6/ffffff?text=${formData.get('name').replace(/\s/g, '+')}`
        };
        
        allRecipes.push(newRecipe);
        saveRecipesToLocalStorage(allRecipes);
        renderRecipes(document.querySelector('.filter-btn.bg-emerald-500').dataset.cuisine);
        addRecipeModal.classList.add('hidden');
    });


    // Initial render
    renderRecipes();
    renderPlanner();
});
</script>

</body>
</html>

