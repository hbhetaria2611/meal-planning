<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeggiPlan: Vegetarian Meal Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Tailwind gray-100 */
        }
        /* Line clamp utilities */
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        /* Selected recipe styling */
        .recipe-selected {
            border: 2px solid #10b981; /* Tailwind emerald-500 */
            background-color: #d1fae5; /* Tailwind emerald-100 */
            transform: scale(1.02);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        /* Clickable meal slot styling */
        .meal-slot-clickable {
            cursor: pointer;
            transition: all 0.2s;
        }
        .meal-slot-clickable:hover {
            background-color: #f3f4f6; /* Tailwind gray-100 */
            transform: scale(1.02);
        }
        /* Hide the scrollbar but keep it scrollable */
        #recipe-list::-webkit-scrollbar {
            width: 8px;
        }
        #recipe-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb {
            background: #d1d5db; /* Tailwind gray-300 */
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* Tailwind gray-400 */
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-3 py-4 sm:px-4 lg:px-8 max-w-7xl">
        <header class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-800 leading-tight">VeggiPlan Meal Planner</h1>
            <p class="text-gray-600 mt-2 text-sm sm:text-base px-4 sm:px-0">Plan your vegetarian week with delicious Indian, Italian, Mexican, and Gujarati recipes!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
            <!-- Weekly Planner Section -->
            <div class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-md sm:shadow-lg">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-3">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Your Weekly Plan</h2>
                    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                        <button id="generate-plan-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-medium py-2 px-3 sm:px-4 rounded-lg transition-all duration-200 text-sm sm:text-base">‚ú® Generate Plan</button>
                        <button id="clear-plan-btn" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-3 sm:px-4 rounded-lg transition-all duration-200 text-sm sm:text-base">Clear Plan</button>
                    </div>
                </div>
                <div id="weekly-planner" class="space-y-3 sm:space-y-4">
                    <!-- Day rows will be generated by JS -->
                </div>
            </div>

            <!-- Sidebar with Recipe Library and Shopping List -->
            <div class="lg:col-span-1 space-y-4 sm:space-y-6 lg:space-y-8">
                
                <!-- Recipe Library Section -->
                <div class="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-md sm:shadow-lg">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 text-gray-800">Recipe Library</h2>
                    <div class="flex flex-wrap gap-1.5 sm:gap-2 mb-4">
                        <button class="filter-btn bg-emerald-500 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all" data-cuisine="all">All</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Indian">Indian</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Italian">Italian</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Mexican">Mexican</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Gujarati">Gujarati</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Mediterranean">Mediterranean</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-all hover:bg-gray-300" data-cuisine="Thai">Thai</button>
                    </div>
                    <div id="recipe-list" class="space-y-3 sm:space-y-4 max-h-[40vh] overflow-y-auto pr-1 sm:pr-2">
                        <!-- Recipe cards will be generated by JS -->
                    </div>
                    <button id="add-recipe-btn" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white font-medium py-2.5 sm:py-3 px-4 rounded-lg transition-all duration-200 text-sm sm:text-base">+ Add New Recipe</button>
                </div>

                <!-- Shopping List Section -->
                <div class="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-md sm:shadow-lg">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-3">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Shopping List</h2>
                        <div class="flex gap-2">
                            <button id="generate-shopping-list-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-1.5 px-3 rounded-lg transition-all duration-200 text-xs sm:text-sm">üìù Generate</button>
                            <button id="clear-shopping-list-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-1.5 px-3 rounded-lg transition-all duration-200 text-xs sm:text-sm">Clear</button>
                        </div>
                    </div>
                    <div id="shopping-list-content" class="max-h-[35vh] overflow-y-auto">
                        <div id="shopping-list-empty" class="text-center text-gray-500 py-8">
                            <p class="text-sm mb-2">No shopping list yet</p>
                            <p class="text-xs">Generate from your weekly plan</p>
                        </div>
                        <div id="shopping-list-items" class="hidden space-y-3">
                            <!-- Shopping list items will be generated by JS -->
                        </div>
                    </div>
                    <div id="shopping-list-summary" class="hidden mt-4 pt-4 border-t border-gray-200">
                        <p class="text-sm text-gray-600">
                            <span class="font-medium">Total items:</span> 
                            <span id="total-items-count">0</span>
                        </p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Recipe Detail Modal -->
    <div id="recipe-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 hidden z-50">
        <div id="modal-content" class="modal-enter bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
             <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Add Recipe Modal -->
    <div id="add-recipe-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 hidden z-50">
        <div class="modal-content transform scale-95 bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <div class="p-4 sm:p-6 border-b flex justify-between items-center">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Add a New Recipe</h3>
                <button id="add-modal-close-btn" class="text-2xl sm:text-3xl font-light text-gray-500 hover:text-gray-800 p-1">&times;</button>
            </div>
            <form id="add-recipe-form" class="p-4 sm:p-6 space-y-4">
                <input type="text" name="name" placeholder="Recipe Name" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <select name="cuisine" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="" disabled selected>Select Cuisine</option>
                    <option value="Indian">Indian</option>
                    <option value="Italian">Italian</option>
                    <option value="Mexican">Mexican</option>
                    <option value="Mediterranean">Mediterranean</option>
                    <option value="Thai">Thai</option>
                    <option value="Korean">Korean</option>
                    <option value="Japanese">Japanese</option>
                    <option value="Middle Eastern">Middle Eastern</option>
                    <option value="Ethiopian">Ethiopian</option>
                    <option value="Moroccan">Moroccan</option>
                    <option value="Brazilian">Brazilian</option>
                    <option value="Spanish">Spanish</option>
                    <option value="Gujarati">Gujarati</option>
                    <option value="Breakfast">Breakfast</option>
                </select>
                <textarea name="description" placeholder="Short description" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="2" required></textarea>
                <div class="grid grid-cols-2 gap-3 sm:gap-4">
                    <input type="number" name="prepTime" placeholder="Prep time (mins)" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <input type="number" name="cookTime" placeholder="Cook time (mins)" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <textarea name="ingredients" placeholder="Ingredients (one per line)" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4 sm:rows-5" required></textarea>
                <textarea name="instructions" placeholder="Instructions (use '1. Step one...' format)" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="5 sm:rows-6" required></textarea>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2.5 sm:py-3 px-4 rounded-lg text-sm sm:text-base transition-colors">Save Recipe</button>
            </form>
        </div>
    </div>

<script src="recipes.js"></script>
<script>
// --- RECIPE DATABASE ---
// Recipes are now loaded from recipes.js file
// The recipes will be available as window.initialRecipes

document.addEventListener('DOMContentLoaded', () => {
    // Combine initial recipes with recipes from local storage
    let allRecipes = [...window.initialRecipes, ...loadRecipesFromLocalStorage()];

    const recipeList = document.getElementById('recipe-list');
    const weeklyPlanner = document.getElementById('weekly-planner');
    const filterBtns = document.querySelectorAll('.filter-btn');
    const generatePlanBtn = document.getElementById('generate-plan-btn');
    const clearPlanBtn = document.getElementById('clear-plan-btn');
    
    // Shopping list elements
    const generateShoppingListBtn = document.getElementById('generate-shopping-list-btn');
    const clearShoppingListBtn = document.getElementById('clear-shopping-list-btn');
    const shoppingListEmpty = document.getElementById('shopping-list-empty');
    const shoppingListItems = document.getElementById('shopping-list-items');
    const shoppingListSummary = document.getElementById('shopping-list-summary');
    const totalItemsCount = document.getElementById('total-items-count');
    
    // Modals
    const recipeModal = document.getElementById('recipe-modal');
    const modalContent = document.getElementById('modal-content');
    const addRecipeModal = document.getElementById('add-recipe-modal');
    const addRecipeBtn = document.getElementById('add-recipe-btn');
    const addModalCloseBtn = document.getElementById('add-modal-close-btn');
    const addRecipeForm = document.getElementById('add-recipe-form');

    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let weeklyPlan = loadPlanFromLocalStorage() || {};
    let shoppingList = loadShoppingListFromLocalStorage() || [];
    let selectedRecipeId = null;

    function saveRecipesToLocalStorage(recipes) {
        const userRecipes = recipes.filter(r => r.id > 1000); // Only save user-added recipes
        localStorage.setItem('mealPlannerUserRecipes', JSON.stringify(userRecipes));
    }

    function loadRecipesFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerUserRecipes')) || [];
    }

    function savePlanToLocalStorage() {
        localStorage.setItem('mealPlannerPlan', JSON.stringify(weeklyPlan));
    }

    function loadPlanFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerPlan'));
    }

    function saveShoppingListToLocalStorage() {
        localStorage.setItem('mealPlannerShoppingList', JSON.stringify(shoppingList));
    }

    function loadShoppingListFromLocalStorage() {
        return JSON.parse(localStorage.getItem('mealPlannerShoppingList'));
    }

    function renderRecipes(filter = 'all') {
        recipeList.innerHTML = '';
        const filteredRecipes = filter === 'all' ? allRecipes : allRecipes.filter(recipe => recipe.cuisine === filter);
        
        filteredRecipes.forEach(recipe => {
            const recipeCard = document.createElement('div');
            recipeCard.className = 'p-3 sm:p-4 border border-gray-200 rounded-lg flex gap-3 sm:gap-4 items-center bg-white shadow-sm hover:shadow-md cursor-pointer transition-all duration-200';
            recipeCard.dataset.recipeId = recipe.id;
            
            recipeCard.innerHTML = `
                <img src="${recipe.imageUrl || 'https://placehold.co/80x80/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-16 h-16 sm:w-20 sm:h-20 rounded-md object-cover flex-shrink-0">
                <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-gray-800 text-sm sm:text-base leading-tight mb-1 truncate">${recipe.name}</h3>
                    <p class="text-xs sm:text-sm text-gray-500">${recipe.cuisine}</p>
                    <div class="flex gap-1 text-xs text-gray-400 mt-1">
                        <span>${recipe.prepTime}m prep</span>
                        <span>‚Ä¢</span>
                        <span>${recipe.cookTime}m cook</span>
                    </div>
                </div>
                <button class="view-btn bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 py-1 sm:py-1.5 rounded-md text-xs sm:text-sm font-medium transition-colors flex-shrink-0" data-recipe-id="${recipe.id}">View</button>
            `;
            recipeList.appendChild(recipeCard);
        });
    }

    function renderPlanner() {
        weeklyPlanner.innerHTML = '';
        days.forEach(day => {
            // Create day row container
            const dayRow = document.createElement('div');
            dayRow.className = 'bg-gray-100 p-3 sm:p-4 rounded-lg';
            
            // Day header
            const dayHeader = document.createElement('h3');
            dayHeader.className = 'font-bold text-sm sm:text-base text-gray-700 mb-3 text-center lg:text-left';
            dayHeader.textContent = day;
            dayRow.appendChild(dayHeader);
            
            // Meals container - responsive: vertical on mobile, horizontal on desktop
            const mealsContainer = document.createElement('div');
            mealsContainer.className = 'flex flex-col lg:flex-row gap-3 lg:gap-4';
            
            ['Lunch', 'Dinner'].forEach(meal => {
                const mealSlotId = `${day}-${meal}`;
                const recipeId = weeklyPlan[mealSlotId];
                const recipe = recipeId ? allRecipes.find(r => r.id == recipeId) : null;
                
                const mealSlot = document.createElement('div');
                mealSlot.className = 'meal-slot meal-slot-clickable bg-white p-3 rounded-lg min-h-[80px] lg:min-h-[100px] flex flex-col justify-center items-center text-center transition-all duration-200 hover:shadow-sm border border-gray-100 lg:flex-1';
                mealSlot.dataset.slotId = mealSlotId;

                if (recipe) {
                    mealSlot.innerHTML = `
                        <p class="text-sm font-semibold text-gray-800 leading-tight mb-1 line-clamp-2">${recipe.name}</p>
                        <p class="text-xs text-gray-500 mb-2">${meal}</p>
                        <div class="flex gap-2">
                            <button class="view-recipe-btn bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 rounded transition-colors" data-recipe-id="${recipe.id}">View</button>
                            <button class="remove-btn bg-red-50 hover:bg-red-100 text-red-600 text-xs px-2 py-1 rounded transition-colors" data-slot-id="${mealSlotId}">Remove</button>
                        </div>
                    `;
                } else {
                    mealSlot.innerHTML = `<span class="text-gray-400 text-sm">${meal}</span>`;
                }
                mealsContainer.appendChild(mealSlot);
            });
            
            dayRow.appendChild(mealsContainer);
            weeklyPlanner.appendChild(dayRow);
        });
    }

    function generateShoppingList() {
        // Get all recipes from the weekly plan
        const plannedRecipeIds = Object.values(weeklyPlan).filter(id => id);
        const plannedRecipes = plannedRecipeIds.map(id => allRecipes.find(r => r.id == id)).filter(r => r);
        
        if (plannedRecipes.length === 0) {
            alert('No recipes in your weekly plan. Add some recipes first!');
            return;
        }

        // Collect all ingredients
        const allIngredients = [];
        plannedRecipes.forEach(recipe => {
            if (recipe.ingredients) {
                recipe.ingredients.forEach(ingredient => {
                    allIngredients.push({
                        name: ingredient,
                        recipe: recipe.name,
                        checked: false
                    });
                });
            }
        });

        // Group similar ingredients (basic grouping by first few words)
        const groupedIngredients = {};
        allIngredients.forEach(item => {
            // Simple grouping by cleaning ingredient names
            let key = item.name.toLowerCase()
                .replace(/^\d+\s*(cups?|tbsp|tsp|oz|lbs?|kg|grams?|ml|liters?)?\s*/, '') // Remove quantities
                .replace(/,.*$/, '') // Remove everything after comma
                .trim();
            
            if (!groupedIngredients[key]) {
                groupedIngredients[key] = [];
            }
            groupedIngredients[key].push(item);
        });

        // Create shopping list items
        shoppingList = [];
        Object.keys(groupedIngredients).forEach(key => {
            const items = groupedIngredients[key];
            const recipes = [...new Set(items.map(item => item.recipe))];
            shoppingList.push({
                ingredient: items[0].name, // Use the first occurrence as the ingredient name
                recipes: recipes,
                checked: false
            });
        });

        saveShoppingListToLocalStorage();
        renderShoppingList();
    }

    function renderShoppingList() {
        if (shoppingList.length === 0) {
            shoppingListEmpty.style.display = 'block';
            shoppingListItems.style.display = 'none';
            shoppingListSummary.style.display = 'none';
            return;
        }

        shoppingListEmpty.style.display = 'none';
        shoppingListItems.style.display = 'block';
        shoppingListSummary.style.display = 'block';

        shoppingListItems.innerHTML = '';
        
        shoppingList.forEach((item, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = `flex items-start gap-3 p-3 rounded-lg border ${item.checked ? 'bg-gray-50 opacity-60' : 'bg-white'}`;
            
            itemDiv.innerHTML = `
                <input type="checkbox" ${item.checked ? 'checked' : ''} 
                       class="mt-1 rounded border-gray-300 text-purple-600 focus:ring-purple-500" 
                       data-index="${index}">
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium ${item.checked ? 'line-through text-gray-500' : 'text-gray-800'}">${item.ingredient}</p>
                    <p class="text-xs text-gray-500 mt-1">For: ${item.recipes.join(', ')}</p>
                </div>
                <button class="kroger-btn bg-blue-600 hover:bg-blue-700 text-white text-xs px-2 py-1 rounded-md transition-colors flex-shrink-0 ml-2" 
                        data-ingredient="${item.ingredient}" 
                        title="Search on Kroger">
                    üõí Kroger
                </button>
            `;
            
            shoppingListItems.appendChild(itemDiv);
        });

        // Update summary
        const totalItems = shoppingList.length;
        const checkedItems = shoppingList.filter(item => item.checked).length;
        totalItemsCount.textContent = `${checkedItems}/${totalItems}`;
    }

    function clearShoppingList() {
        shoppingList = [];
        saveShoppingListToLocalStorage();
        renderShoppingList();
    }

    function searchKroger(ingredient) {
        // Clean up the ingredient name for better search results
        const searchTerm = ingredient
            .replace(/^\d+\s*(cups?|tbsp|tsp|oz|lbs?|kg|grams?|ml|liters?)?\s*/, '') // Remove quantities
            .replace(/,.*$/, '') // Remove everything after comma
            .replace(/\(.*?\)/g, '') // Remove parentheses and contents
            .trim();
        
        // Encode the search term for URL
        const encodedSearch = encodeURIComponent(searchTerm);
        
        // Open Kroger search in a new tab
        const krogerUrl = `https://www.kroger.com/search?query=${encodedSearch}`;
        window.open(krogerUrl, '_blank');
    }
    
    function showRecipeModal(recipeId) {
        const recipe = allRecipes.find(r => r.id == recipeId);
        if (!recipe) return;

        modalContent.innerHTML = `
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 leading-tight flex-1 pr-4">${recipe.name}</h2>
                    <button id="modal-close-btn" class="text-2xl sm:text-3xl font-light text-gray-500 hover:text-gray-800 p-1 flex-shrink-0">&times;</button>
                </div>
                <img src="${recipe.imageUrl || 'https://placehold.co/600x400/e2e8f0/cbd5e0?text=Food'}" alt="${recipe.name}" class="w-full h-48 sm:h-64 object-cover rounded-lg mb-4">
                <p class="text-gray-600 mb-4 text-sm sm:text-base leading-relaxed">${recipe.description}</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6 text-center">
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Cuisine</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.cuisine}</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Prep Time</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.prepTime} mins</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="text-xs sm:text-sm text-gray-500">Cook Time</div>
                        <div class="font-semibold text-sm sm:text-base">${recipe.cookTime} mins</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 text-gray-800 border-b border-gray-200 pb-2">Ingredients</h3>
                        <ul class="list-none space-y-2 text-gray-700 text-sm sm:text-base">
                            ${recipe.ingredients.map(ing => `<li class="flex items-start"><span class="text-green-500 mr-2">‚Ä¢</span><span>${ing}</span></li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 text-gray-800 border-b border-gray-200 pb-2">Instructions</h3>
                        <div class="space-y-3 text-gray-700 text-sm sm:text-base leading-relaxed whitespace-pre-line">${recipe.instructions}</div>
                    </div>
                </div>
            </div>
        `;
        recipeModal.classList.remove('hidden');
        setTimeout(() => modalContent.classList.add('modal-enter-active'), 10);
        document.getElementById('modal-close-btn').addEventListener('click', closeRecipeModal);
    }
    
    function closeRecipeModal() {
        modalContent.classList.remove('modal-enter-active');
        modalContent.classList.add('modal-exit-active');
        setTimeout(() => {
            recipeModal.classList.add('hidden');
            modalContent.classList.remove('modal-exit-active');
        }, 300);
    }

    function handleFilterClick(e) {
        filterBtns.forEach(btn => {
            btn.classList.remove('bg-emerald-500', 'text-white');
            btn.classList.add('bg-gray-200', 'text-gray-700');
        });
        e.target.classList.add('bg-emerald-500', 'text-white');
        e.target.classList.remove('bg-gray-200', 'text-gray-700');
        renderRecipes(e.target.dataset.cuisine);
    }

    function generateRandomPlan() {
        if (allRecipes.length === 0) {
            alert("There are no recipes to generate a plan from. Please add some recipes first!");
            return;
        }
        weeklyPlan = {};
        days.forEach(day => {
            ['Lunch', 'Dinner'].forEach(meal => {
                const randomRecipe = allRecipes[Math.floor(Math.random() * allRecipes.length)];
                weeklyPlan[`${day}-${meal}`] = randomRecipe.id;
            });
        });
        renderPlanner();
        savePlanToLocalStorage();
    }
    
    // Event Listeners
    filterBtns.forEach(btn => btn.addEventListener('click', handleFilterClick));
    generatePlanBtn.addEventListener('click', generateRandomPlan);
    clearPlanBtn.addEventListener('click', () => {
        weeklyPlan = {};
        renderPlanner();
        savePlanToLocalStorage();
    });
    
    // Shopping list event listeners
    generateShoppingListBtn.addEventListener('click', generateShoppingList);
    clearShoppingListBtn.addEventListener('click', clearShoppingList);
    
    // Shopping list item interactions
    shoppingListItems.addEventListener('click', (e) => {
        if (e.target.type === 'checkbox') {
            const index = parseInt(e.target.dataset.index);
            shoppingList[index].checked = e.target.checked;
            saveShoppingListToLocalStorage();
            renderShoppingList();
        } else if (e.target.classList.contains('kroger-btn')) {
            const ingredient = e.target.dataset.ingredient;
            searchKroger(ingredient);
        }
    });


    recipeModal.addEventListener('click', (e) => {
        if (e.target === recipeModal) {
            closeRecipeModal();
        }
    });

    weeklyPlanner.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-btn')) {
            delete weeklyPlan[e.target.dataset.slotId];
            renderPlanner();
            savePlanToLocalStorage();
        } else if (e.target.classList.contains('view-recipe-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        } else {
            // Check if clicking on an empty meal slot
            const mealSlot = e.target.closest('.meal-slot');
            if (mealSlot && mealSlot.dataset.slotId) {
                const slotId = mealSlot.dataset.slotId;
                // Only add recipe if a recipe is selected
                if (selectedRecipeId) {
                    addRecipeToSlot(slotId);
                }
            }
        }
    });

    // Click-to-Add Logic
    function selectRecipe(recipeId) {
        selectedRecipeId = recipeId;
        // Update visual selection
        document.querySelectorAll('.recipe-selected').forEach(card => {
            card.classList.remove('recipe-selected');
        });
        const selectedCard = document.querySelector(`[data-recipe-id="${recipeId}"]`);
        if (selectedCard) {
            selectedCard.classList.add('recipe-selected');
        }
    }

    function addRecipeToSlot(slotId) {
        if (selectedRecipeId) {
            weeklyPlan[slotId] = selectedRecipeId;
            renderPlanner();
            savePlanToLocalStorage();
        }
    }

    // Recipe selection event listener
    recipeList.addEventListener('click', (e) => {
        const recipeCard = e.target.closest('[data-recipe-id]');
        if (recipeCard && !e.target.classList.contains('view-btn')) {
            selectRecipe(recipeCard.dataset.recipeId);
        }
        if (e.target.classList.contains('view-btn')) {
            showRecipeModal(e.target.dataset.recipeId);
        }
    });
    
    // Add recipe modal logic
    addRecipeBtn.addEventListener('click', () => {
        addRecipeForm.reset();
        addRecipeModal.classList.remove('hidden');
    });

    addModalCloseBtn.addEventListener('click', () => {
        addRecipeModal.classList.add('hidden');
    });

    addRecipeModal.addEventListener('click', (e) => {
        if (e.target === addRecipeModal) {
            addRecipeModal.classList.add('hidden');
        }
    });
    
    addRecipeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const newRecipe = {
            id: Date.now(), // Simple unique ID
            name: formData.get('name'),
            cuisine: formData.get('cuisine'),
            description: formData.get('description'),
            prepTime: parseInt(formData.get('prepTime')),
            cookTime: parseInt(formData.get('cookTime')),
            ingredients: formData.get('ingredients').split('\n').filter(i => i.trim() !== ''),
            instructions: formData.get('instructions'),
            imageUrl: `https://placehold.co/600x400/8b5cf6/ffffff?text=${formData.get('name').replace(/\s/g, '+')}`
        };
        
        allRecipes.push(newRecipe);
        saveRecipesToLocalStorage(allRecipes);
        renderRecipes(document.querySelector('.filter-btn.bg-emerald-500').dataset.cuisine);
        addRecipeModal.classList.add('hidden');
    });


    // Initial render
    renderRecipes();
    renderPlanner();
    renderShoppingList();
});
</script>

</body>
</html>

